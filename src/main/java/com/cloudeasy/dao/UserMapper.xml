<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloudeasy.dao.UserMapper">
  <resultMap id="BaseResultMap" type="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="role_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="username" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="password" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="type" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="mobile_phone" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="telephone" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="email" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="fax" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="memo" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="last_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="the_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="last_ip" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="the_ip" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="is_freeze" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="is_delete" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="create_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="create_user_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="create_type" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="update_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="realname" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="enabled" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="salt" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="flag" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="province" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="address" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="age" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="win" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="company" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="short_company" javaType="java.lang.String" jdbcType="VARCHAR" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, role_id, username, password, type, mobile_phone, telephone, email, fax, memo, 
    last_time, the_time, last_ip, the_ip, is_freeze, is_delete, create_time, create_user_id, 
    create_type, update_time, realname, enabled, salt, flag,province,address,age,win,company,short_company
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_tbl
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from user_tbl
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into user_tbl (role_id, username, password, 
      type, mobile_phone, telephone, 
      email, fax, memo, last_time, 
      the_time, last_ip, the_ip, 
      is_freeze, is_delete, create_time, 
      create_user_id, create_type, update_time, 
      realname, enabled, salt, 
      flag,province,address,age,win,company,short_company)
    values (#{roleId,jdbcType=INTEGER}, #{username,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{type,jdbcType=INTEGER}, #{mobilePhone,jdbcType=VARCHAR}, #{telephone,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{fax,jdbcType=VARCHAR}, #{memo,jdbcType=VARCHAR}, #{lastTime,jdbcType=TIMESTAMP}, 
      #{theTime,jdbcType=TIMESTAMP}, #{lastIp,jdbcType=VARCHAR}, #{theIp,jdbcType=VARCHAR}, 
      #{isFreeze,jdbcType=CHAR}, #{isDelete,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{createUserId,jdbcType=INTEGER}, #{createType,jdbcType=INTEGER}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{realname,jdbcType=VARCHAR}, #{enabled,jdbcType=CHAR}, #{salt,jdbcType=VARCHAR}, 
      #{flag,jdbcType=CHAR},#{province,jdbcType=VARCHAR},#{address,jdbcType=VARCHAR},#{age,jdbcType=INTEGER},
      #{win,jdbcType=CHAR},#{company,jdbcType=VARCHAR},#{shortCompany,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into user_tbl
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="roleId != null">
        role_id,
      </if>
      <if test="username != null">
        username,
      </if>
      <if test="password != null">
        password,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="mobilePhone != null">
        mobile_phone,
      </if>
      <if test="telephone != null">
        telephone,
      </if>
      <if test="email != null">
        email,
      </if>
      <if test="fax != null">
        fax,
      </if>
      <if test="memo != null">
        memo,
      </if>
      <if test="lastTime != null">
        last_time,
      </if>
      <if test="theTime != null">
        the_time,
      </if>
      <if test="lastIp != null">
        last_ip,
      </if>
      <if test="theIp != null">
        the_ip,
      </if>
      <if test="isFreeze != null">
        is_freeze,
      </if>
      <if test="isDelete != null">
        is_delete,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="createUserId != null">
        create_user_id,
      </if>
      <if test="createType != null">
        create_type,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="realname != null">
        realname,
      </if>
      <if test="enabled != null">
        enabled,
      </if>
      <if test="salt != null">
        salt,
      </if>
      <if test="flag != null">
        flag,
      </if>
      <if test="province != null">
        province,
      </if>
      <if test="address != null">
        address,
      </if>
      <if test="age != null">
        age,
      </if>
      <if test="win != null">
        win,
      </if>
      <if test="company != null">
        company,
      </if>
      <if test="shortCompany != null">
        short_company,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="roleId != null">
        #{roleId,jdbcType=INTEGER},
      </if>
      <if test="username != null">
        #{username,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="mobilePhone != null">
        #{mobilePhone,jdbcType=VARCHAR},
      </if>
      <if test="telephone != null">
        #{telephone,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        #{fax,jdbcType=VARCHAR},
      </if>
      <if test="memo != null">
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="lastTime != null">
        #{lastTime,jdbcType=TIMESTAMP},
      </if>
      <if test="theTime != null">
        #{theTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastIp != null">
        #{lastIp,jdbcType=VARCHAR},
      </if>
      <if test="theIp != null">
        #{theIp,jdbcType=VARCHAR},
      </if>
      <if test="isFreeze != null">
        #{isFreeze,jdbcType=CHAR},
      </if>
      <if test="isDelete != null">
        #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUserId != null">
        #{createUserId,jdbcType=INTEGER},
      </if>
      <if test="createType != null">
        #{createType,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="realname != null">
        #{realname,jdbcType=VARCHAR},
      </if>
      <if test="enabled != null">
        #{enabled,jdbcType=CHAR},
      </if>
      <if test="salt != null">
        #{salt,jdbcType=VARCHAR},
      </if>
      <if test="flag != null">
        #{flag,jdbcType=CHAR},
      </if>
      <if test="province != null">
        #{province,jdbcType=VARCHAR},
      </if>
      <if test="address != null">
        #{address,jdbcType=VARCHAR},
      </if>
      <if test="age != null">
        #{age,jdbcType=INTEGER},
      </if>
      <if test="win != null">
        #{win,jdbcType=CHAR},
      </if>
      <if test="company != null">
        #{company,jdbcType=VARCHAR},
      </if>
      <if test="shortCompany != null">
        #{shortCompany,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_tbl
    <set>
      <if test="roleId != null">
        role_id = #{roleId,jdbcType=INTEGER},
      </if>
      <if test="username != null">
        username = #{username,jdbcType=VARCHAR},
      </if>
      <if test="password != null">
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=INTEGER},
      </if>
      <if test="mobilePhone != null">
        mobile_phone = #{mobilePhone,jdbcType=VARCHAR},
      </if>
      <if test="telephone != null">
        telephone = #{telephone,jdbcType=VARCHAR},
      </if>
      <if test="email != null">
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="fax != null">
        fax = #{fax,jdbcType=VARCHAR},
      </if>
      <if test="memo != null">
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="lastTime != null">
        last_time = #{lastTime,jdbcType=TIMESTAMP},
      </if>
      <if test="theTime != null">
        the_time = #{theTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastIp != null">
        last_ip = #{lastIp,jdbcType=VARCHAR},
      </if>
      <if test="theIp != null">
        the_ip = #{theIp,jdbcType=VARCHAR},
      </if>
      <if test="isFreeze != null">
        is_freeze = #{isFreeze,jdbcType=CHAR},
      </if>
      <if test="isDelete != null">
        is_delete = #{isDelete,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createUserId != null">
        create_user_id = #{createUserId,jdbcType=INTEGER},
      </if>
      <if test="createType != null">
        create_type = #{createType,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="realname != null">
        realname = #{realname,jdbcType=VARCHAR},
      </if>
      <if test="enabled != null">
        enabled = #{enabled,jdbcType=CHAR},
      </if>
      <if test="salt != null">
        salt = #{salt,jdbcType=VARCHAR},
      </if>
      <if test="flag != null">
        flag = #{flag,jdbcType=CHAR},
      </if>
      <if test="province != null">
        province = #{province,jdbcType=VARCHAR},
      </if>
      <if test="address != null">
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="age != null">
      	age =  #{age,jdbcType=INTEGER},
      </if>
      <if test="win != null">
      	win =  #{win,jdbcType=VARCHAR},
      </if>
      <if test="company != null">
        company = #{company,jdbcType=VARCHAR},
      </if>
      <if test="shortCompany != null">
        short_company = #{shortCompany,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_tbl
    set role_id = #{roleId,jdbcType=INTEGER},
      username = #{username,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      type = #{type,jdbcType=INTEGER},
      mobile_phone = #{mobilePhone,jdbcType=VARCHAR},
      telephone = #{telephone,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      fax = #{fax,jdbcType=VARCHAR},
      memo = #{memo,jdbcType=VARCHAR},
      last_time = #{lastTime,jdbcType=TIMESTAMP},
      the_time = #{theTime,jdbcType=TIMESTAMP},
      last_ip = #{lastIp,jdbcType=VARCHAR},
      the_ip = #{theIp,jdbcType=VARCHAR},
      is_freeze = #{isFreeze,jdbcType=CHAR},
      is_delete = #{isDelete,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      create_user_id = #{createUserId,jdbcType=INTEGER},
      create_type = #{createType,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      realname = #{realname,jdbcType=VARCHAR},
      enabled = #{enabled,jdbcType=CHAR},
      salt = #{salt,jdbcType=VARCHAR},
      flag = #{flag,jdbcType=CHAR},
      province = #{province,jdbcType=CHAR},
      address = #{address,jdbcType=VARCHAR},
      age = #{age,jdbcType=INTEGER},
      win = #{age,jdbcType=CHAR},
      company = #{company,jdbcType=VARCHAR},
      short_company = #{shortCompany,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <!-- 新增  start-->
    <!-- 查询用户名是否存在 -->
    <select id="isUserName" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1 
		<if test="username != null and username != ''">
	    	and username=#{username}
		</if>
	</select>
	<!-- 查询邮箱是否存在 -->
    <select id="isUserEmail" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1  
		<if test="email != null and email != ''">
	    	and email=#{email}
		</if>
	</select>
	<!-- 查询手机是否存在 -->
    <select id="isUserMobile" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1 
		<if test="mobile != null and mobile != ''">
	    	and mobile_phone=#{mobile}
		</if>
	</select>
	<!-- 查询IP是否存在 -->
    <select id="isUserIp" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1 
		<if test="ip != null and ip != ''">
	    	and the_ip=#{ip}
		</if>
		<if test="monthStart != null and monthEnd != null and monthStart != '' and monthEnd != ''">
	    	and (create_time between CONCAT(#{monthStart}, '00:00:00') and CONCAT(#{monthEnd}, '23:59:59'))
	    </if>
	</select>
	
    <!-- 验证当前这个月是否已有10人中奖？ -->
    <select id="hasMoreTenWin" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1 
	    and win=1
	    <if test="monthStart != null and monthEnd != null and monthStart != '' and monthEnd != ''">
	    and (create_time between CONCAT(#{monthStart}, '00:00:00') and CONCAT(#{monthEnd}, '23:59:59'))
	    </if>
	</select>
	
  <!-- 系统用户 列表总数-->
	<select id="queryByCount" parameterType="com.cloudeasy.dto.BaseDTO" resultType="java.lang.Integer">
		select count(1) from user_tbl 
		where is_delete!=1 and role_id!=1
		<if test="username != null and username != ''">
	    	username like CONCAT('%', #{username}, '%')
		</if>
			
	</select>
	  	
	<!-- 查询系统用户列表 -->
	<select id="queryByList" parameterType="com.cloudeasy.dto.BaseDTO" resultMap="BaseResultMap">
		select 
		<include refid="Base_Column_List" />
		from user_tbl 
		where is_delete!=1 and role_id!=1
			<if test="username != null and username != ''">
	    	username like CONCAT('%', #{username}, '%')
			</if>
			<if test="pager.orderCondition != null and pager.orderCondition != ''">
		      ${pager.orderCondition}
		    </if>
		    <if test="pager.mysqlQueryCondition != null and pager.mysqlQueryCondition != ''">
		       ${pager.mysqlQueryCondition}
		    </if>
	</select>
	
	  <!-- 查询活动会员 -->
	  <select id="queryAllUser" parameterType="com.cloudeasy.dto.BaseDTO" resultMap="BaseResultMap">
		select 
		<include refid="Base_Column_List" />
		from user_tbl 
		where is_delete!=1 and role_id=0
	</select> 
	<!-- 新增end -->
</mapper>