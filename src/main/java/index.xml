<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="index">
<resultMap id="UserModel" type="com.cloudeasy.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="role_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="username" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="password" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="type" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="mobile_phone" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="telephone" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="email" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="fax" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="memo" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="last_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="the_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="last_ip" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="the_ip" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="is_freeze" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="is_delete" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="create_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="create_user_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="create_type" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="update_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="realname" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="enabled" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="salt" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="flag" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="company" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="short_company" javaType="java.lang.String" jdbcType="VARCHAR" />
    </constructor>
  </resultMap>
  
  <resultMap id="Role" type="com.cloudeasy.model.Role">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="memo" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="view" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="flag" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="create_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="is_deleted" javaType="java.lang.String" jdbcType="CHAR" />
    </constructor>
  </resultMap>
  
   <resultMap id="Resource" type="com.cloudeasy.model.Resource">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <constructor>
      <idArg column="id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="name" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="url" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="type" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="parent_id" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="is_deleted" javaType="java.lang.String" jdbcType="CHAR" />
      <arg column="create_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="update_time" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="rank" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="actions" javaType="java.lang.String" jdbcType="VARCHAR" />
       <arg column="is_menu" javaType="java.lang.String" jdbcType="VARCHAR" />
       <arg column="flag" javaType="java.lang.String" jdbcType="CHAR" />
       <arg column="seq" javaType="java.lang.Integer" jdbcType="INTEGER" />
    </constructor>
  </resultMap>

<!-- 查询用户 -->
<select id="selectByUsername" resultMap="UserModel" parameterType="com.cloudeasy.mybatis.DynamicParameter" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
	    id, role_id, username, password, type, mobile_phone, telephone, email, fax, memo, 
	    last_time, the_time, last_ip, the_ip, is_freeze, is_delete, create_time, create_user_id, 
	    create_type, update_time, realname, enabled,salt,flag,company,short_company
    from user_tbl
    where username = #{username}
  </select>
  
  <select id="selectRolesByUsername" parameterType="com.cloudeasy.mybatis.DynamicParameter" resultMap="Role">
    select
        T1.*
    from 
        role_tbl T1 
        inner join 
        user_role_tbl T2
        on T1.id = T2.role_id 
        inner join 
        user_tbl T3
        on T3.id = T2.user_id
    where  
        T3.username = #{username}
  </select>
  
   <select id="selectAllRoles" parameterType="com.cloudeasy.mybatis.DynamicParameter" resultMap="Role">
    select 
    id,name,memo,view,flag,create_time, is_deleted
    from
        role_tbl
    where 
    	is_deleted='0'
  </select>
  
  <select id="selectResourcesByRoleName" parameterType="com.cloudeasy.mybatis.DynamicParameter" resultMap="Resource">
    select 
        T1.id
        ,T1.name
        ,T1.url
        ,T1.type
        ,T1.parent_id
        ,T1.is_deleted
        ,T1.create_time
        ,T1.update_time
        ,T1.rank
        ,T1.actions
        ,T1.is_menu
        ,T1.flag
        ,T1.seq
    from 
        resource_tbl T1 
        inner join 
        role_resource_tbl T2
        on T1.id = T2.resource_id 
        inner join 
        role_tbl T3
        on T3.id = T2.role_id
    where
    	T1.flag = #{flag}
        and T3.name = #{name}
  </select>
  
	  <!-- 获取顶级菜单 -->
	<select id="getResource"  resultMap="Resource" parameterType="com.cloudeasy.mybatis.DynamicParameter">
		select 
	        T1.id
	        ,T1.name
	        ,T1.url
	        ,T1.type
	        ,T1.parent_id
	        ,T1.is_deleted
	        ,T1.create_time
	        ,T1.update_time
	        ,T1.rank
	        ,T1.actions
	        ,T1.is_menu
	        ,T1.flag
	        ,T1.seq
	    from 
	        resource_tbl T1 
	        inner join 
	        role_resource_tbl T2
	        on T1.id = T2.resource_id 
	        inner join 
	        role_tbl T3
	        on T3.id = T2.role_id
	        inner join
	        user_role_tbl T4
	        on T4.role_id=T3.id
	        inner join user_tbl T5
	        on T4.user_id = T5.id
	    where
	    	T1.is_deleted= 0
	    	and T1.is_menu='1'
	    	and T1.flag = #{flag}
	    	<if test="iobj != null and iobj != '' ">
	    		and T1.parent_id != #{iobj}
	    	</if>
	    	<if test="obj != null and obj != '' ">
	    		and parent_id = #{obj}
	    	</if>
	        and T5.username = #{username}
	     order by T1.id asc
	</select>
	
	<!-- 查询系统品牌列表 -->
	<select id="findAllBrand" parameterType="com.cloudeasy.mybatis.DynamicParameter" resultType="com.cloudeasy.model.Brand">
		select 
			id, brand, pic_src as picSrc, banner_pic as bannerPic, brand_image as brandImage, brand_desc as brandDesc, brand_outline as brandOutLine, url, create_time as createTime, 
    		create_user as createUser, flag
		from brand_tbl 
		where flag = #{flag}
	</select>
	<!-- 新增end -->
	
	 <!-- 批量删除 -->
  <delete id="batchDelete" parameterType="com.cloudeasy.mybatis.DynamicParameter">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ${tableName}
    where 1=1
     <if test="ids != null" >
      and  id in 
               <foreach close=")" collection="ids" item="item" open="("
                   separator=",">
                   #{item}
             </foreach>
       </if>
  </delete>

<!-- 批量插入角色 -->   
  <insert id="batchInsert" parameterType="com.cloudeasy.mybatis.DynamicParameter" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into role_resource_tbl (role_id, resource_id)
    values 
    <foreach collection="list" item="item" index="index"
            separator=",">
            (#{item.roleId},#{item.resourceId})
        </foreach>
  </insert>
  
 <!-- 批量插入产品分类 -->
  <insert id="batchInsertCategory" parameterType="com.cloudeasy.mybatis.DynamicParameter" >
    insert into product_category_tbl (product_id, category_id)
    values 
    <foreach collection="list" item="item" index="index"
            separator=",">
            (#{item.productId},#{item.categoryId})
        </foreach>
  </insert>
</mapper>